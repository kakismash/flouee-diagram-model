<div class="diagram-editor">
  <div class="editor-container">
    <!-- Sidebar -->
    <mat-sidenav-container class="sidenav-container">
      <mat-sidenav mode="side" opened class="sidenav">
        <mat-nav-list>
          <h3 mat-subheader>Tables</h3>
          @for (table of tables(); track table.id) {
            <mat-list-item 
              [class.selected]="selectedTable()?.id === table.id"
              (click)="selectedTable.set(table)">
              <mat-icon matListItemIcon>table_chart</mat-icon>
              <span matListItemTitle>{{ table.name }}</span>
              <span matListItemLine>{{ table.columns.length }} columns</span>
            </mat-list-item>
          }
          
          @if (tables().length === 0) {
            <mat-list-item>
              <span matListItemTitle>No tables yet</span>
              <span matListItemLine>Click "Add Table" to get started</span>
            </mat-list-item>
          }
        </mat-nav-list>
      </mat-sidenav>

      <!-- Main content -->
      <mat-sidenav-content class="main-content">
        <div class="canvas-container"
             #canvasContainer
             (mousedown)="onCanvasMouseDown($event)"
             (mousemove)="onCanvasMouseMove($event)"
             (mouseup)="onCanvasMouseUp($event)"
             (wheel)="onCanvasWheel($event)"
             (touchstart)="onCanvasTouchStart($event)"
             (touchmove)="onCanvasTouchMove($event)"
             (touchend)="onCanvasTouchEnd($event)">
          
          <!-- HTML container for table cards -->
          <div 
            class="table-cards-container"
            [style.transform]="canvasTransform()"
            [style.transform-origin]="'0 0'">
            
            <!-- Relationship Lines (behind tables) -->
            @for (rel of relationships(); track rel.id) {
              @if (getTableById(rel.fromTableId) && getTableById(rel.toTableId)) {
                <app-relationship-line
                  [relationship]="rel"
                  [fromTable]="getTableById(rel.fromTableId)!"
                  [toTable]="getTableById(rel.toTableId)!"
                  [zoomLevel]="canvasGrid.getScale()"
                  [relationshipDisplayColumn]="getRelationshipDisplayColumnForRelationship(rel.id)"
                  (relationshipTypeChanged)="onRelationshipTypeChanged($event)"
                  (relationshipDeleted)="onRelationshipDeleted($event)">
                </app-relationship-line>
              }
            }
            
            <!-- Table Cards -->
            @for (table of tables(); track table.id) {
              <app-table-card
                [table]="table"
                [x]="table.x"
                [y]="table.y"
                [zoomLevel]="canvasGrid.getScale()"
                [isSelected]="selectedTable()?.id === table.id"
                [relationshipDisplayColumns]="getRelationshipDisplayColumns(table.id)"
                [allTables]="tables()"
                (positionChanged)="onTablePositionChanged(table, $event)"
                (dragPositionChanged)="onTableDragPositionChanged($event)"
                (tableSelected)="onTableSelected($event)"
                (tableEdited)="onTableEdited($event)"
                (tableDeleted)="onTableDeleted($event)"
                (linkRequested)="onLinkRequested($event)"
                (relationshipDisplayColumnUpdated)="updateRelationshipDisplayColumnFields($event.displayColumn, $event.newFields)">
              </app-table-card>
            }
          </div>
          
          <div class="canvas-overlay">
            <div class="instructions">
              <p><strong>Instructions:</strong></p>
              <p>• Drag to pan around the canvas</p>
              <p>• Mouse wheel to zoom in/out</p>
              <p>• Click + button to add table</p>
              <p>• Double-click table to edit</p>
            </div>
            
            <button mat-fab 
                    color="primary" 
                    class="add-table-button"
                    (click)="addTable()"
                    matTooltip="Add New Table">
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </div>
      </mat-sidenav-content>
    </mat-sidenav-container>
  </div>
  
  <!-- Notifications -->
  <app-notification></app-notification>
</div>
